<div id="analytics" class="page">
    <div class="analytics-header">
        <h2>Финансовая аналитика</h2>
        <div class="period-controls">
            <div class="period-buttons">
                <button class="period-btn" data-period="quarter">
                    <i class="fas fa-chart-bar"></i>
                    <span>За квартал</span>
                </button>
                <button class="period-btn" data-period="year">
                    <i class="fas fa-chart-line"></i>
                    <span>За год</span>
                </button>
                <button class="period-btn" data-period="custom" id="customPeriodBtn">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Произвольный промежуток</span>
                </button>
            </div>
        </div>
    </div>

    <div class="analytics-grid">
        <!-- График доходов/расходов -->
        <div class="card chart-card-full">
            <div class="chart-header">
                <h3 id="chartTitle">Динамика доходов и расходов</h3>
                <div class="chart-actions">
                    <button class="btn-icon" id="exportChart" title="Экспорт графика">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
            <div class="chart-container-full">
                <canvas id="incomeExpenseChart"></canvas>
            </div>
        </div>

        <!-- Круговая диаграмма -->
        <div class="card chart-card">
            <div class="chart-header">
                <h3>Распределение доходов</h3>
            </div>
            <div class="chart-container-small">
                <canvas id="objectsChart"></canvas>
            </div>
        </div>

        <!-- Статистика -->
        <div class="card stats-card">
            <h3>Ключевые показатели</h3>
            <div class="stats-list">
                <div class="stat-item">
                    <div class="stat-icon income">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Общий доход</div>
                        <div class="stat-value" id="analyticsIncome">0 ₽</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon tax">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Уплачено налогов</div>
                        <div class="stat-value" id="analyticsTaxes">0 ₽</div>
                    </div>
                </div>

                <div class="stat-item highlight">
                    <div class="stat-icon profit">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Чистая прибыль</div>
                        <div class="stat-value" id="analyticsProfit">0 ₽</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon contracts">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Активных договоров</div>
                        <div class="stat-value" id="analyticsContracts">0</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon margin">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Рентабельность</div>
                        <div class="stat-value" id="analyticsMargin">0%</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-icon burden">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Налоговая нагрузка</div>
                        <div class="stat-value" id="analyticsTaxBurden">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно произвольного периода -->
    <div class="modal hidden" id="customPeriodModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-calendar-alt"></i>
                    Выбор произвольного промежутка
                </h3>
                <button class="btn-icon modal-close" id="closeCustomPeriodModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="date-range-grid">
                    <div class="date-input-group">
                        <label for="customPeriodStartDate">
                            <i class="fas fa-calendar-plus"></i>
                            Дата начала
                        </label>
                        <div class="date-input-wrapper">
                            <input type="date" id="customPeriodStartDate" class="form-input date-input">
                        </div>
                    </div>

                    <div class="date-input-group">
                        <label for="customPeriodEndDate">
                            <i class="fas fa-calendar-minus"></i>
                            Дата окончания
                        </label>
                        <div class="date-input-wrapper">
                            <input type="date" id="customPeriodEndDate" class="form-input date-input">
                        </div>
                    </div>
                </div>

                <div class="period-note">
                    <i class="fas fa-info-circle"></i>
                    Минимальный промежуток - 7 дней, максимальный - 5 лет
                </div>

                <div class="selected-range-info" id="customRangeInfo">
                    <strong>Выбранный период:</strong>
                    <span id="customRangeText">Не выбран</span>
                </div>

                <div class="date-error hidden" id="customPeriodError">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="customPeriodErrorText"></span>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" id="cancelCustomPeriod">
                    Отмена
                </button>
                <button class="btn-primary" id="applyCustomPeriod">
                    <i class="fas fa-check"></i>
                    Применить
                </button>
            </div>
        </div>
    </div>
</div>